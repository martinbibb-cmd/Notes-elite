<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Depot Notes-Elite (PWA mock)</title>
<meta name="theme-color" content="#0a67ff"/>
<link rel="manifest" href="data:application/manifest+json,{&quot;name&quot;:&quot;Depot Notes-Elite&quot;,&quot;short_name&quot;:&quot;Notes-Elite&quot;,&quot;start_url&quot;:&quot;.&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#ffffff&quot;,&quot;theme_color&quot;:&quot;#0a67ff&quot;}">
<style>
:root{
  --bg:#ffffff;
  --ink:#0b3a76;
  --brand:#0a67ff;
  --brand-20:#0a67ff33;
  --line:#cfd8e3;
  --tile:#f8fafc;
  --ok:#12b886;
  --muted:#6b7280;
  --radius:16px;
  --shadow:0 6px 24px rgba(0,0,0,.06);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--ink); background:var(--bg);
}
.app{
  max-width: 1100px; margin:0 auto; padding:24px 24px 72px;
  background:
    radial-gradient(#e5e7eb 1px, transparent 1px) 0 0/18px 18px;
  min-height:100dvh;
}
h1{font-size:40px; margin:8px 0 16px; text-align:center; letter-spacing:.2px}
h2{font-size:28px; margin:8px 0 12px; text-align:center}
.grid{display:grid; gap:24px}
.tiles{
  display:grid; grid-template-columns: repeat(3, minmax(200px,1fr)); gap:24px; justify-items:stretch;
}
.tile{
  background:var(--tile); border:2px solid var(--brand-20); border-radius: var(--radius);
  padding:28px; text-align:center; font-weight:700; font-size:28px; color:#0a67ff;
  cursor:pointer; transition: transform .06s ease, box-shadow .1s ease, border-color .1s ease;
  box-shadow:var(--shadow);
}
.tile:hover{ transform: translateY(-2px); }
.header{
  display:flex; gap:12px; align-items:center; justify-content:flex-start; margin:8px 0 16px;
}
.btn{
  appearance:none; border:0; background:var(--brand); color:white; border-radius:999px;
  padding:10px 16px; font-weight:700; cursor:pointer; box-shadow: var(--shadow);
}
.btn.ghost{ background:transparent; color:var(--brand); border:2px solid var(--brand-20)}
.btn.small{ padding:8px 12px; font-size:14px}
.row{display:flex; gap:24px; align-items:flex-start}
.card{
  background:white; border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
  padding:16px;
}
.list{display:grid; gap:16px}
.item{
  display:grid; grid-template-columns: 36px 1fr 240px; gap:16px; align-items:center;
}
.item .icon{width:28px; height:28px; opacity:.9}
.slider{width:100%}
.noteBox{min-height:260px; width:100%; resize:vertical; padding:12px; border-radius:12px; border:1px solid var(--line)}
.help{color:var(--muted); font-size:13px}
.section{
  display:none;
}
.section.active{display:block}
.progress{
  height:8px; background:#e5e7eb; border-radius:999px; overflow:hidden; margin:24px 0 8px;
}
.progress > div{height:100%; width:0%; background:var(--brand); transition:width .2s}
.footerActions{
  position: fixed; right:18px; bottom:18px; display:flex; gap:10px; z-index:9;
}
.iconBtn{
  background:white; border:1px solid var(--line); border-radius:12px; padding:10px 12px; cursor:pointer; box-shadow:var(--shadow)
}
.iconBtn:hover{border-color:#9aa4b2}
.kv{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.chips{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
.chip{
  padding:8px 12px; border-radius:999px; border:1px solid var(--line); background:white; cursor:pointer; font-weight:600; font-size:14px;
}
.chip.active{ border-color:var(--brand); box-shadow:0 0 0 2px var(--brand-20) inset; color:var(--brand)}
.sys-tiles{display:grid; grid-template-columns: repeat(3, 1fr); gap:24px}
.sys-tiles .tile{font-size:18px; padding:12px}
.sysimg{
  display:flex; align-items:center; justify-content:center; background:white; border:1px dashed var(--line);
  height:160px; border-radius:12px; font-size:13px; color:var(--muted)
}
.badge{background:#eef2ff; color:#2f5aff; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700}
.sep{height:1px; background:#e5e7eb; margin:10px 0}
@media (max-width:900px){
  .tiles{grid-template-columns: 1fr}
  .item{grid-template-columns: 36px 1fr; grid-template-rows: auto auto}
  .item .slider{grid-column: 1 / -1}
  .sys-tiles{grid-template-columns: 1fr}
}
</style>
</head>
<body>
<div class="app">
  <h1>Depot notes</h1>

  <!-- HOME -->
  <section id="home" class="section active">
    <div class="tiles">
      <div class="tile" data-go="customer">Customer</div>
      <div class="tile" data-go="system">System</div>
      <div class="tile" data-go="safety">Safety</div>
    </div>

    <div class="progress" aria-label="progress"><div id="progressBar"></div></div>
    <div class="help">Tip: You can export/import JSON from the bottom-right at any time. Autosaves locally.</div>
  </section>

  <!-- CUSTOMER -->
  <section id="customer" class="section">
    <div class="header">
      <button class="btn small" data-go="home">Home</button>
      <span class="badge">Customer priorities</span>
    </div>
    <h2>Customer</h2>

    <div class="row">
      <div class="card" style="flex:1">
        <div class="list" id="customerList"><!-- injected --></div>
      </div>
      <div class="card" style="width:360px">
        <div class="kv"><strong>Notes</strong><span class="help">e.g. Future plans</span></div>
        <textarea id="customerNotes" class="noteBox" placeholder="Type notesâ€¦"></textarea>
        <div class="sep"></div>
        <label class="help"><input type="checkbox" id="customerBrandLoyalty"> Customer prefers specific brand</label>
      </div>
    </div>
  </section>

  <!-- SYSTEM -->
  <section id="system" class="section">
    <div class="header">
      <button class="btn small" data-go="home">Home</button>
      <span class="badge">System mapping</span>
    </div>
    <h2>System</h2>

    <div class="card">
      <h3 style="margin:0 0 8px">Current</h3>
      <div class="sys-tiles" id="sysCurrent">
        <!-- image tiles -->
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <h3 style="margin:0 0 8px">New</h3>
      <div class="sys-tiles" id="sysNew">
        <!-- image tiles -->
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <h3 style="margin:0 0 8px">Plumbing & fuel (stubs)</h3>
      <div class="chips" id="stubs">
        <span class="chip" data-stub="flue">Flue</span>
        <span class="chip" data-stub="condensate">Condensate</span>
        <span class="chip" data-stub="gas">Gas</span>
        <span class="chip" data-stub="controls">Controls</span>
      </div>
      <div class="help">These are placeholders; selecting toggles a boolean and reserves a section in JSON for your next build.</div>
    </div>
  </section>

  <!-- SAFETY -->
  <section id="safety" class="section">
    <div class="header">
      <button class="btn small" data-go="home">Home</button>
      <span class="badge">Safety</span>
    </div>
    <h2>Safety</h2>

    <div class="tiles" style="grid-template-columns: repeat(3,minmax(220px,1fr))">
      <div class="tile" data-safety="workingAtHeights">Working at heights</div>
      <div class="tile" data-safety="environmental">Environmental</div>
      <div class="tile" data-safety="electrical">Electrical</div>
      <div class="tile" data-safety="animals">Animals</div>
      <div class="tile" data-safety="customer">Customer</div>
      <div class="tile" data-safety="other">Other</div>
    </div>

    <div id="safetyPanel" class="card" style="margin-top:20px; display:none">
      <div class="kv">
        <strong id="safetyTitle">Category</strong>
        <span class="help">Tap to toggle. Everything is saved automatically.</span>
      </div>
      <div class="chips" id="safetyChips"></div>
      <div class="sep"></div>
      <textarea id="safetyNotes" class="noteBox" placeholder="Category notesâ€¦"></textarea>
    </div>
  </section>

  <!-- Floating actions -->
  <div class="footerActions">
    <button id="btnImport" class="iconBtn" title="Import JSON">ðŸ“¥ Import</button>
    <button id="btnExport" class="iconBtn" title="Export JSON">ðŸ“¤ Export</button>
  </div>
  <input type="file" id="fileInput" accept="application/json" hidden />
</div>

<script>
/* ------------------ State & Schema ------------------ */
const DEFAULT = {
  meta:{ app:"Depot Notes-Elite PWA", version:"0.1.0", updated:new Date().toISOString() },
  customer:{
    priorities:{
      disruption:50, ongoingCost:50, immediateCost:50, waterPressure:50,
      multipleTaps:50, futurePlans:50, brandLoyaltyLevel:50, afterCare:50
    },
    notes:"", brandLoyalty:false
  },
  system:{
    current:null, // 'regular' | 'system' | 'combi' | 'warmAir' | 'none' | 'storageCombi' | 'ufh'
    next:null,    // same enum as above
    stubs:{ flue:false, condensate:false, gas:false, controls:false }
  },
  safety:{
    workingAtHeights:{ items:[], notes:"" },
    environmental:{ items:[], notes:"" },
    electrical:{ items:[], notes:"" },
    animals:{ items:[], notes:"" },
    customer:{ items:[], notes:"" },
    other:{ items:[], notes:"" }
  }
};
let state = load() || structuredClone(DEFAULT);

/* ------------------ Router ------------------ */
const screens = Array.from(document.querySelectorAll('.section'));
document.querySelectorAll('[data-go]').forEach(el=>{
  el.addEventListener('click', ()=>go(el.dataset.go));
});
function go(id){
  screens.forEach(s=>s.classList.toggle('active', s.id===id));
  window.scrollTo({top:0, behavior:'instant'});
  save();
  renderProgress();
}
function renderProgress(){
  // naive completion: 8 sliders + current + new + any safety tick
  let total=10, score=0;
  const p = state.customer.priorities;
  score += Object.values(p).filter(v=>typeof v==='number' && v!==50).length; // changed sliders
  if(state.system.current) score++;
  if(state.system.next) score++;
  const anySafety = Object.values(state.safety).some(v=>v.items?.length);
  if(anySafety) score++;
  document.getElementById('progressBar').style.width = Math.min(100, (score/total)*100)+'%';
}
renderProgress();

/* ------------------ Customer ------------------ */
const customerFields = [
  {key:'disruption', label:'Disruption', icon:'âš ï¸'},
  {key:'ongoingCost', label:'On going cost', icon:'ðŸ’·'},
  {key:'immediateCost', label:'Immediate cost', icon:'ðŸ’¸'},
  {key:'waterPressure', label:'Water pressure', icon:'ðŸŒŠ'},
  {key:'multipleTaps', label:'Multiple taps', icon:'ðŸš¿'},
  {key:'futurePlans', label:'Future plans', icon:'ðŸ§­'},
  {key:'brandLoyaltyLevel', label:'Brand loyalty', icon:'ðŸŽ¯'},
  {key:'afterCare', label:'After care', icon:'ðŸ› ï¸'},
];
const clist = document.getElementById('customerList');
function renderCustomer(){
  clist.innerHTML='';
  customerFields.forEach(f=>{
    const row=document.createElement('div'); row.className='item';
    row.innerHTML = `
      <div class="icon" aria-hidden="true">${f.icon}</div>
      <div>${f.label}</div>
      <input type="range" min="0" max="100" step="1" class="slider" value="${state.customer.priorities[f.key]}" data-key="${f.key}">
    `;
    clist.appendChild(row);
  });
  document.getElementById('customerNotes').value = state.customer.notes || '';
  document.getElementById('customerBrandLoyalty').checked = !!state.customer.brandLoyalty;
}
clist.addEventListener('input', e=>{
  if(e.target.matches('.slider')){
    state.customer.priorities[e.target.dataset.key] = Number(e.target.value);
    save(); renderProgress();
  }
});
document.getElementById('customerNotes').addEventListener('input', e=>{
  state.customer.notes = e.target.value; save();
});
document.getElementById('customerBrandLoyalty').addEventListener('change', e=>{
  state.customer.brandLoyalty = e.target.checked; save();
});
renderCustomer();

/* ------------------ System ------------------ */
const systemOptions = [
  {key:'regular', label:'Regular (OV)'},
  {key:'system', label:'System'},
  {key:'combi', label:'Combi'},
  {key:'storageCombi', label:'Storage combi'},
  {key:'warmAir', label:'Warm air'},
  {key:'ufh', label:'Underfloor'},
  {key:'none', label:'None'}
];
function mkSysTile(opt, group){
  const el = document.createElement('div');
  el.className='tile';
  el.innerHTML = `
    <div class="sysimg">${opt.label} diagram</div>
    <div style="margin-top:8px; font-weight:800">${opt.label}</div>
  `;
  el.addEventListener('click', ()=>{
    state.system[group] = opt.key;
    save(); renderSystem(); renderProgress();
  });
  if(state.system[group]===opt.key){
    el.style.borderColor='var(--brand)';
    el.style.boxShadow='0 0 0 3px var(--brand-20)';
  }
  return el;
}
function renderSystem(){
  const cur = document.getElementById('sysCurrent');
  const nxt = document.getElementById('sysNew');
  cur.innerHTML=''; nxt.innerHTML='';
  systemOptions.forEach(o=>cur.appendChild(mkSysTile(o,'current')));
  ['regular','system','combi'].map(k=>systemOptions.find(o=>o.key===k)).forEach(o=>{
    if(o) nxt.appendChild(mkSysTile(o,'next'));
  });
  // stubs
  document.querySelectorAll('#stubs .chip').forEach(ch=>{
    const k = ch.dataset.stub;
    ch.classList.toggle('active', !!state.system.stubs[k]);
  });
}
document.getElementById('stubs').addEventListener('click', e=>{
  const chip = e.target.closest('.chip'); if(!chip) return;
  const k=chip.dataset.stub;
  state.system.stubs[k]=!state.system.stubs[k];
  save(); renderSystem();
});
renderSystem();

/* ------------------ Safety ------------------ */
const SAFETY_LIBRARY = {
  workingAtHeights: {
    title:'Working at heights',
    items:[
      'WAH01 Ladder access required',
      'WAH02A Scaffold â€“ tower standard',
      'WAH02B Scaffold â€“ tower bridging',
      'WAH02C Scaffold â€“ cantilever',
      'WAH03 Roof access permit required',
      'WAH04A Loft access boarded',
      'WAH04B Loft access unboarded',
      'WAH05 MEWP required',
      'WAH06 Flat roof â€“ builder to make good',
      'WAH50 Ladder 1:4 (~75Â°), secure footing',
      'WAH51 Reach limits / exclusion zone'
    ]
  },
  environmental: {
    title:'Environmental',
    items:['ASB: suspected asbestos','Confined space','Poor lighting','Ventilation concerns','Waste/skip required']
  },
  electrical: {
    title:'Electrical',
    items:['Spur required','RCD absent','Consumer unit access','Bonding check required']
  },
  animals: {
    title:'Animals',
    items:['Dogs on site','Cats on site','Livestock nearby','Allergy risk']
  },
  customer: {
    title:'Customer',
    items:['Vulnerable customer','Interpreter needed','Key-safe access','Carer present']
  },
  other: {
    title:'Other',
    items:['Parking restrictions','Neighbour access','Permit required','Noise/time restrictions']
  }
};
let currentSafetyKey=null;
document.querySelectorAll('[data-safety]').forEach(t=>{
  t.addEventListener('click', ()=>{
    currentSafetyKey = t.dataset.safety;
    openSafety(currentSafetyKey);
  });
});
function openSafety(key){
  const lib = SAFETY_LIBRARY[key];
  document.getElementById('safetyTitle').textContent = lib.title;
  const wrap = document.getElementById('safetyChips'); wrap.innerHTML='';
  const selected = new Set(state.safety[key].items || []);
  lib.items.forEach(txt=>{
    const chip = document.createElement('span'); chip.className='chip'; chip.textContent=txt;
    if(selected.has(txt)) chip.classList.add('active');
    chip.addEventListener('click', ()=>{
      if(selected.has(txt)){ selected.delete(txt); }
      else selected.add(txt);
      state.safety[key].items = Array.from(selected);
      chip.classList.toggle('active');
      save(); renderProgress();
    });
    wrap.appendChild(chip);
  });
  const notes = document.getElementById('safetyNotes');
  notes.value = state.safety[key].notes || '';
  notes.oninput = (e)=>{ state.safety[key].notes = e.target.value; save(); };
  document.getElementById('safetyPanel').style.display='block';
}

/* ------------------ Storage & IO ------------------ */
function save(){
  state.meta.updated = new Date().toISOString();
  localStorage.setItem('notesElite', JSON.stringify(state));
}
function load(){
  try{ return JSON.parse(localStorage.getItem('notesElite')); }
  catch(e){ return null; }
}

/* Export / Import */
document.getElementById('btnExport').addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
  const a = document.createElement('a');
  const stamp = new Date().toISOString().replace(/[:.]/g,'-');
  a.href = URL.createObjectURL(blob);
  a.download = `depot-notes-${stamp}.json`;
  a.click();
});
document.getElementById('btnImport').addEventListener('click', ()=>document.getElementById('fileInput').click());
document.getElementById('fileInput').addEventListener('change', async e=>{
  const file = e.target.files[0]; if(!file) return;
  try{
    const text = await file.text();
    const obj = JSON.parse(text);
    state = Object.assign(structuredClone(DEFAULT), obj); // merge with defaults for forward-compat
    save();
    renderCustomer(); renderSystem(); renderProgress();
    document.getElementById('safetyPanel').style.display='none';
    alert('Imported JSON and refreshed UI.');
  }catch(err){
    alert('Import failed: '+err.message);
  }finally{ e.target.value=''; }
});

/* ------------------ Navigation clicks from tiles ------------------ */
document.querySelectorAll('.tile[data-go]').forEach(t=> t.addEventListener('click', ()=>go(t.dataset.go)));
/* Initial */
go('home');
</script>
</body>
</html>
